@inject NavigationManager Navigation
@inject HttpClient Http

@if (contentLoaded)
{
    @ChildContent
}
else
{
    <video autoplay="autoplay" muted id="logoAnimation">
        <source src="videos/logo-animation.mp4" type="video/mp4" />
    </video>
}

@code {
    bool contentLoaded;

    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (Navigation.Uri.Replace("#", string.Empty) == Navigation.BaseUri)
        {
            await LoadAllData();

            await Task.Delay(4000);
            contentLoaded = true;
            StateHasChanged();
        }
        else
        {
            contentLoaded = true;
        }
    }

    private async Task LoadAllData()
    {
        GLOBALS.all_verb_data = CleanCSV((await Http.GetStringAsync("csv_files/all_verb.csv")));
        GLOBALS.sets_verb_data = CleanCSV((await Http.GetStringAsync("csv_files/sets_verb.csv")));
        GLOBALS.all_vocab_data = CleanCSV((await Http.GetStringAsync("csv_files/all_vocab.csv")));
        GLOBALS.sets_vocab_data = CleanCSV(await Http.GetStringAsync("csv_files/sets_vocab.csv"));
    }

    private string[] CleanCSV(string csvData)
    {
        return csvData.Split('\n').Select(x => x.Replace("\r", string.Empty)).ToArray()[1..];
    }
}